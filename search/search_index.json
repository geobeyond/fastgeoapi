{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"fastgeoapi A modern, high-performance geospatial API framework that extends pygeoapi with authentication, authorization, and security features using FastAPI, OpenID Connect, and Open Policy Agent (OPA) \ud83d\uddfa\ufe0f\ud83d\udd12. Architecture This diagram gives an overview of the basic architecture: Features \ud83d\udd10 Security & Authentication OpenID Connect (OIDC) Integration - OAuth2/JWT Bearer token authentication with JWKS support API Key Authentication - Flexible API key-based authentication for programmatic access Open Policy Agent (OPA) - Policy-based authorization with fine-grained access control Multi-scheme Support - Seamlessly switch between authentication methods based on your needs \ud83d\ude80 Performance & Modern Stack FastAPI Framework - High-performance async API built on Starlette and Pydantic Async I/O - Non-blocking operations for better scalability Modern Python - Python 3.12+ with type hints and modern language features Fast Dependency Management - UV-based tooling for lightning-fast installations \ud83d\uddfa\ufe0f Geospatial API Standards OGC API Compliance - Full support for OGC API - Features, Processes, and more OpenAPI Integration - Auto-generated, security-enhanced OpenAPI specifications Geospatial Data Access - Seamless access to vector and raster geospatial data pygeoapi Extension - Extends vanilla pygeoapi with enterprise-ready security \ud83d\udee1\ufe0f Security Testing & Quality Contract Testing - Automated OpenAPI contract validation with Schemathesis Security Scanning - OWASP ZAP integration for continuous security testing Pre-commit Hooks - Code quality checks with Ruff formatting and linting Comprehensive Test Coverage - Full test suite with pytest and coverage reporting \ud83d\udccb OGC API Conformance Specification Validation - Automated validation against OGC API standards using ogcapi-registry OpenAPI Document Verification - Ensures generated OpenAPI documents conform to OGC API specifications Conformance Class Reporting - Detailed reports on declared conformance classes (OGC API - Features, Common, GeoJSON, etc.) CI/CD Integration - Continuous validation on every deployment to the demo server Live Demo A public demo server is available at https://fastgeoapi.fly.dev/geoapi . \ud83d\udd10 The API endpoints are protected with OAuth2 client-credentials flow , showcasing fastgeoapi's enterprise-ready security features. This allows you to test the full authentication workflow in a real environment. The Swagger UI documentation is publicly accessible without authentication at https://fastgeoapi.fly.dev/geoapi/openapi , allowing you to explore the API specification and available endpoints before authenticating. Getting an Access Token The demo server requires OAuth2 authentication. To obtain an access token: curl -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\" Using the Access Token Once you have the token, include it in your requests: # Get the landing page curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/?f=json\" # List collections curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/collections?f=json\" # Check conformance curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/conformance?f=json\" Requirements pygeoapi fastapi-opa An OpenID Connect provider (Keycloak, WSO2, etc) Open Policy Agent (OPA) Installation You can install fastgeoapi via pip from PyPI : pip install fastgeoapi Development Prerequisites Install UV - a fast Python package installer and resolver: macOS / Linux: curl -sSf https://install.ultraviolet.dev | sh Windows (PowerShell): powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\" Setup After cloning the repository, use UV to install dependencies: git clone https://github.com/geobeyond/fastgeoapi.git cd fastgeoapi uv sync This automatically: Creates a virtual environment in .venv Installs all required dependencies including git-based packages from [tool.uv.sources] (pygeoapi master, pygeofilter, fencer) Sets up fastgeoapi in development mode Note: For development, UV uses git-based dependencies defined in [tool.uv.sources] to get the latest features from upstream projects. The PyPI release uses stable published versions. See uv.md for more details. Activate the Virtual Environment macOS / Linux: source .venv/bin/activate Windows (PowerShell): . venv \\ Scripts \\ Activate . ps1 Running fastgeoapi Once Keycloak and OPA have been started, configure the required environment variables: export PYGEOAPI_CONFIG = pygeoapi-config.yml export PYGEOAPI_OPENAPI = pygeoapi-openapi.yml export FASTGEOAPI_CONTEXT = '/geoapi' Start fastgeoapi in development mode: uv run fastapi run app/main.py --app app --host 0 .0.0.0 --port 5000 --reload Quick Start (Package Installation) Install fastgeoapi: pip install fastgeoapi Create a .env file with the required configuration: # Environment state: 'dev' or 'prod' ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi # Authentication (choose one, all others must be false) DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Start the server: fastgeoapi run With options: fastgeoapi run --host 0 .0.0.0 --port 5000 --reload See the Getting Started guide for complete setup instructions including authentication options and examples. Common UV Commands # Update dependencies uv sync --upgrade # View installed packages uv pip list # Install a new package uv pip install package-name # Install dev dependencies uv pip install --group dev For more details, see uv.md . Release Workflow This project uses a branching strategy with automated releases: Branch Target Description develop TestPyPI Development releases with .dev suffix main PyPI Production releases when version is bumped Development Releases Push to develop branch triggers automatic publishing to TestPyPI : git checkout develop # Make changes git commit -m \"feat: add new feature\" git push origin develop The workflow automatically creates a dev version (e.g., 0.0.4.dev.1733912345 ) and publishes to TestPyPI. Production Releases To create a production release on PyPI : Update the version in pyproject.toml Merge to main branch The workflow detects the version change, creates a git tag, and publishes to PyPI # Update version in pyproject.toml to e.g., 0.0.4 git checkout main git merge develop git push origin main Both workflows use Trusted Publisher (OIDC) for secure, tokenless authentication with PyPI/TestPyPI. Usage Please see the Command-line Reference for details. Please have a look at the docker-compose.yml file under scripts/iam to start the stack with Keycloak and Open Policy Agent locally. There is a README.md file that explains how to use it. The file scripts/iam/keycloak/realm-export.json can be used to import an already configured realm into Keycloak. The files under scripts/postman can be used to setup Postman with a configuration that is ready to perform the requests for the whole stack. Contributing Contributions are very welcome. To learn more, see the Contributor Guide . License Distributed under the terms of the MIT license , fastgeoapi is free and open-source software. Issues If you encounter any problems, please file an issue along with a detailed description. MCP Server (Model Context Protocol) fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server is built using FastMCP and automatically generates tools from the pygeoapi OpenAPI specification. Features Automatic Tool Generation - Tools are generated from the OGC API OpenAPI spec OAuth Authentication - Supports OIDC authentication with any OAuth provider (Logto, Auth0, Keycloak, etc.) RFC 9728 Compliant - Implements OAuth 2.0 Protected Resource Metadata Dynamic Client Registration - Compatible with mcp-remote and other MCP clients Provider Agnostic - Uses mcpauth for multi-IdP support Enabling the MCP Server To enable the MCP server, set the FASTGEOAPI_WITH_MCP environment variable: # In your .env file DEV_FASTGEOAPI_WITH_MCP = true # Or for production PROD_FASTGEOAPI_WITH_MCP = true The MCP server will be mounted at /mcp endpoint. Configuration Basic Configuration (No Authentication) # .env file ENV_STATE = dev DEV_FASTGEOAPI_WITH_MCP = true DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml With OAuth Authentication To enable OAuth authentication for the MCP server, configure JWKS: # .env file ENV_STATE = dev DEV_FASTGEOAPI_WITH_MCP = true DEV_JWKS_ENABLED = true DEV_OIDC_WELL_KNOWN_ENDPOINT = https://your-idp.example.com/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret Security & Authentication Flows The MCP server supports multiple security configurations depending on your deployment needs. Supported OAuth 2.0 Flows Flow Use Case Configuration Authorization Code + PKCE Interactive clients (Claude Desktop, mcp-remote) JWKS_ENABLED=true with OIDC config Client Credentials Machine-to-machine, service accounts JWKS_ENABLED=true with OIDC config Dynamic Client Registration (DCR) Auto-registration for MCP clients Enabled automatically with OIDC OAuth Proxy Architecture When OAuth is enabled, the MCP server acts as an OAuth Proxy implementing: RFC 8414 - OAuth 2.0 Authorization Server Metadata RFC 9728 - OAuth 2.0 Protected Resource Metadata RFC 7636 - Proof Key for Code Exchange (PKCE) RFC 7591 - OAuth 2.0 Dynamic Client Registration \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 MCP Client \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 MCP Server \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Identity \u2502 \u2502 (mcp-remote) \u2502 \u2502 (OAuth Proxy) \u2502 \u2502 Provider \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 1. Discovery \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 /.well-known/... \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 2. DCR (register) \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 3. Authorization \u2502 4. Redirect to IdP \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 5. Auth Code \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 6. Token Exchange \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 7. MCP Requests \u2502 8. Internal API call \u2502 \u2502 (with Bearer token) \u2502 (bypasses auth) \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Security Features Feature Description JWT Validation Tokens are validated using JWKS from the IdP Opaque Token Support Supports IdPs that return opaque tokens (e.g., Logto without API Resources) RFC 6750 Compliance Proper error handling for missing vs invalid tokens Internal API Bypass MCP-to-API calls use an internal key to bypass authentication Scope Validation Configurable required scopes for access control Supported Identity Providers The MCP server is provider-agnostic and works with any OIDC-compliant IdP: Logto - Tested with OAuth proxy and DCR Auth0 - Full OIDC support Keycloak - Full OIDC and OPA integration Okta - Standard OIDC flows Azure AD - Microsoft identity platform Google - Google OAuth 2.0 Using the MCP Server With Claude Desktop Add the following to your Claude Desktop configuration ( ~/Library/Application Support/Claude/claude_desktop_config.json on macOS): { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" ] } } } With mcp-remote (OAuth) When OAuth is enabled, mcp-remote handles authentication automatically: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" , \"--allow-http\" ] } } } The --allow-http flag is needed for local development. In production with HTTPS, remove this flag. Direct SSE Connection For clients that support Server-Sent Events directly: http://localhost:5000/mcp/sse Available Tools The MCP server exposes all OGC API endpoints as tools, including: Tool Description getLandingPage Get the API landing page getConformance Get OGC API conformance classes getCollections List all feature collections getCollection Get metadata for a specific collection getItems Query features from a collection getItem Get a specific feature by ID getProcesses List available processes (if OGC API - Processes is enabled) OAuth Discovery Endpoints When OAuth is enabled, the following RFC-compliant endpoints are available: Endpoint Description /.well-known/oauth-protected-resource/mcp/ Protected resource metadata (RFC 9728) /mcp/.well-known/oauth-authorization-server Authorization server metadata (RFC 8414) Architecture \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Claude Desktop \u2502 \u2502 or MCP Client \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 MCP Protocol (SSE/HTTP) \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 fastgeoapi \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 MCP Server (/mcp) \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 OAuth Proxy \u2502 \u2502 Tool Router \u2502 \u2502 SSE/HTTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u25bc \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 pygeoapi OGC API (/geoapi) \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Credits This project was generated from \\@cjolowicz \\'s Hypermodern Python Cookiecutter template.","title":"Home"},{"location":"#fastgeoapi","text":"A modern, high-performance geospatial API framework that extends pygeoapi with authentication, authorization, and security features using FastAPI, OpenID Connect, and Open Policy Agent (OPA) \ud83d\uddfa\ufe0f\ud83d\udd12.","title":"fastgeoapi"},{"location":"#architecture","text":"This diagram gives an overview of the basic architecture:","title":"Architecture"},{"location":"#features","text":"","title":"Features"},{"location":"#security-authentication","text":"OpenID Connect (OIDC) Integration - OAuth2/JWT Bearer token authentication with JWKS support API Key Authentication - Flexible API key-based authentication for programmatic access Open Policy Agent (OPA) - Policy-based authorization with fine-grained access control Multi-scheme Support - Seamlessly switch between authentication methods based on your needs","title":"\ud83d\udd10 Security &amp; Authentication"},{"location":"#performance-modern-stack","text":"FastAPI Framework - High-performance async API built on Starlette and Pydantic Async I/O - Non-blocking operations for better scalability Modern Python - Python 3.12+ with type hints and modern language features Fast Dependency Management - UV-based tooling for lightning-fast installations","title":"\ud83d\ude80 Performance &amp; Modern Stack"},{"location":"#geospatial-api-standards","text":"OGC API Compliance - Full support for OGC API - Features, Processes, and more OpenAPI Integration - Auto-generated, security-enhanced OpenAPI specifications Geospatial Data Access - Seamless access to vector and raster geospatial data pygeoapi Extension - Extends vanilla pygeoapi with enterprise-ready security","title":"\ud83d\uddfa\ufe0f Geospatial API Standards"},{"location":"#security-testing-quality","text":"Contract Testing - Automated OpenAPI contract validation with Schemathesis Security Scanning - OWASP ZAP integration for continuous security testing Pre-commit Hooks - Code quality checks with Ruff formatting and linting Comprehensive Test Coverage - Full test suite with pytest and coverage reporting","title":"\ud83d\udee1\ufe0f Security Testing &amp; Quality"},{"location":"#ogc-api-conformance","text":"Specification Validation - Automated validation against OGC API standards using ogcapi-registry OpenAPI Document Verification - Ensures generated OpenAPI documents conform to OGC API specifications Conformance Class Reporting - Detailed reports on declared conformance classes (OGC API - Features, Common, GeoJSON, etc.) CI/CD Integration - Continuous validation on every deployment to the demo server","title":"\ud83d\udccb OGC API Conformance"},{"location":"#live-demo","text":"A public demo server is available at https://fastgeoapi.fly.dev/geoapi . \ud83d\udd10 The API endpoints are protected with OAuth2 client-credentials flow , showcasing fastgeoapi's enterprise-ready security features. This allows you to test the full authentication workflow in a real environment. The Swagger UI documentation is publicly accessible without authentication at https://fastgeoapi.fly.dev/geoapi/openapi , allowing you to explore the API specification and available endpoints before authenticating.","title":"Live Demo"},{"location":"#getting-an-access-token","text":"The demo server requires OAuth2 authentication. To obtain an access token: curl -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\"","title":"Getting an Access Token"},{"location":"#using-the-access-token","text":"Once you have the token, include it in your requests: # Get the landing page curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/?f=json\" # List collections curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/collections?f=json\" # Check conformance curl -H \"Authorization: Bearer <your_access_token>\" \\ \"https://fastgeoapi.fly.dev/geoapi/conformance?f=json\"","title":"Using the Access Token"},{"location":"#requirements","text":"pygeoapi fastapi-opa An OpenID Connect provider (Keycloak, WSO2, etc) Open Policy Agent (OPA)","title":"Requirements"},{"location":"#installation","text":"You can install fastgeoapi via pip from PyPI : pip install fastgeoapi","title":"Installation"},{"location":"#development","text":"","title":"Development"},{"location":"#prerequisites","text":"Install UV - a fast Python package installer and resolver: macOS / Linux: curl -sSf https://install.ultraviolet.dev | sh Windows (PowerShell): powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"","title":"Prerequisites"},{"location":"#setup","text":"After cloning the repository, use UV to install dependencies: git clone https://github.com/geobeyond/fastgeoapi.git cd fastgeoapi uv sync This automatically: Creates a virtual environment in .venv Installs all required dependencies including git-based packages from [tool.uv.sources] (pygeoapi master, pygeofilter, fencer) Sets up fastgeoapi in development mode Note: For development, UV uses git-based dependencies defined in [tool.uv.sources] to get the latest features from upstream projects. The PyPI release uses stable published versions. See uv.md for more details.","title":"Setup"},{"location":"#activate-the-virtual-environment","text":"macOS / Linux: source .venv/bin/activate Windows (PowerShell): . venv \\ Scripts \\ Activate . ps1","title":"Activate the Virtual Environment"},{"location":"#running-fastgeoapi","text":"Once Keycloak and OPA have been started, configure the required environment variables: export PYGEOAPI_CONFIG = pygeoapi-config.yml export PYGEOAPI_OPENAPI = pygeoapi-openapi.yml export FASTGEOAPI_CONTEXT = '/geoapi' Start fastgeoapi in development mode: uv run fastapi run app/main.py --app app --host 0 .0.0.0 --port 5000 --reload","title":"Running fastgeoapi"},{"location":"#quick-start-package-installation","text":"Install fastgeoapi: pip install fastgeoapi Create a .env file with the required configuration: # Environment state: 'dev' or 'prod' ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi # Authentication (choose one, all others must be false) DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Start the server: fastgeoapi run With options: fastgeoapi run --host 0 .0.0.0 --port 5000 --reload See the Getting Started guide for complete setup instructions including authentication options and examples.","title":"Quick Start (Package Installation)"},{"location":"#common-uv-commands","text":"# Update dependencies uv sync --upgrade # View installed packages uv pip list # Install a new package uv pip install package-name # Install dev dependencies uv pip install --group dev For more details, see uv.md .","title":"Common UV Commands"},{"location":"#release-workflow","text":"This project uses a branching strategy with automated releases: Branch Target Description develop TestPyPI Development releases with .dev suffix main PyPI Production releases when version is bumped","title":"Release Workflow"},{"location":"#development-releases","text":"Push to develop branch triggers automatic publishing to TestPyPI : git checkout develop # Make changes git commit -m \"feat: add new feature\" git push origin develop The workflow automatically creates a dev version (e.g., 0.0.4.dev.1733912345 ) and publishes to TestPyPI.","title":"Development Releases"},{"location":"#production-releases","text":"To create a production release on PyPI : Update the version in pyproject.toml Merge to main branch The workflow detects the version change, creates a git tag, and publishes to PyPI # Update version in pyproject.toml to e.g., 0.0.4 git checkout main git merge develop git push origin main Both workflows use Trusted Publisher (OIDC) for secure, tokenless authentication with PyPI/TestPyPI.","title":"Production Releases"},{"location":"#usage","text":"Please see the Command-line Reference for details. Please have a look at the docker-compose.yml file under scripts/iam to start the stack with Keycloak and Open Policy Agent locally. There is a README.md file that explains how to use it. The file scripts/iam/keycloak/realm-export.json can be used to import an already configured realm into Keycloak. The files under scripts/postman can be used to setup Postman with a configuration that is ready to perform the requests for the whole stack.","title":"Usage"},{"location":"#contributing","text":"Contributions are very welcome. To learn more, see the Contributor Guide .","title":"Contributing"},{"location":"#license","text":"Distributed under the terms of the MIT license , fastgeoapi is free and open-source software.","title":"License"},{"location":"#issues","text":"If you encounter any problems, please file an issue along with a detailed description.","title":"Issues"},{"location":"#mcp-server-model-context-protocol","text":"fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server is built using FastMCP and automatically generates tools from the pygeoapi OpenAPI specification.","title":"MCP Server (Model Context Protocol)"},{"location":"#features_1","text":"Automatic Tool Generation - Tools are generated from the OGC API OpenAPI spec OAuth Authentication - Supports OIDC authentication with any OAuth provider (Logto, Auth0, Keycloak, etc.) RFC 9728 Compliant - Implements OAuth 2.0 Protected Resource Metadata Dynamic Client Registration - Compatible with mcp-remote and other MCP clients Provider Agnostic - Uses mcpauth for multi-IdP support","title":"Features"},{"location":"#enabling-the-mcp-server","text":"To enable the MCP server, set the FASTGEOAPI_WITH_MCP environment variable: # In your .env file DEV_FASTGEOAPI_WITH_MCP = true # Or for production PROD_FASTGEOAPI_WITH_MCP = true The MCP server will be mounted at /mcp endpoint.","title":"Enabling the MCP Server"},{"location":"#configuration","text":"","title":"Configuration"},{"location":"#basic-configuration-no-authentication","text":"# .env file ENV_STATE = dev DEV_FASTGEOAPI_WITH_MCP = true DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml","title":"Basic Configuration (No Authentication)"},{"location":"#with-oauth-authentication","text":"To enable OAuth authentication for the MCP server, configure JWKS: # .env file ENV_STATE = dev DEV_FASTGEOAPI_WITH_MCP = true DEV_JWKS_ENABLED = true DEV_OIDC_WELL_KNOWN_ENDPOINT = https://your-idp.example.com/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret","title":"With OAuth Authentication"},{"location":"#security-authentication-flows","text":"The MCP server supports multiple security configurations depending on your deployment needs.","title":"Security &amp; Authentication Flows"},{"location":"#supported-oauth-20-flows","text":"Flow Use Case Configuration Authorization Code + PKCE Interactive clients (Claude Desktop, mcp-remote) JWKS_ENABLED=true with OIDC config Client Credentials Machine-to-machine, service accounts JWKS_ENABLED=true with OIDC config Dynamic Client Registration (DCR) Auto-registration for MCP clients Enabled automatically with OIDC","title":"Supported OAuth 2.0 Flows"},{"location":"#oauth-proxy-architecture","text":"When OAuth is enabled, the MCP server acts as an OAuth Proxy implementing: RFC 8414 - OAuth 2.0 Authorization Server Metadata RFC 9728 - OAuth 2.0 Protected Resource Metadata RFC 7636 - Proof Key for Code Exchange (PKCE) RFC 7591 - OAuth 2.0 Dynamic Client Registration \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 MCP Client \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 MCP Server \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Identity \u2502 \u2502 (mcp-remote) \u2502 \u2502 (OAuth Proxy) \u2502 \u2502 Provider \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 1. Discovery \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 /.well-known/... \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 2. DCR (register) \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 3. Authorization \u2502 4. Redirect to IdP \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 5. Auth Code \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 6. Token Exchange \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 7. MCP Requests \u2502 8. Internal API call \u2502 \u2502 (with Bearer token) \u2502 (bypasses auth) \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502","title":"OAuth Proxy Architecture"},{"location":"#security-features","text":"Feature Description JWT Validation Tokens are validated using JWKS from the IdP Opaque Token Support Supports IdPs that return opaque tokens (e.g., Logto without API Resources) RFC 6750 Compliance Proper error handling for missing vs invalid tokens Internal API Bypass MCP-to-API calls use an internal key to bypass authentication Scope Validation Configurable required scopes for access control","title":"Security Features"},{"location":"#supported-identity-providers","text":"The MCP server is provider-agnostic and works with any OIDC-compliant IdP: Logto - Tested with OAuth proxy and DCR Auth0 - Full OIDC support Keycloak - Full OIDC and OPA integration Okta - Standard OIDC flows Azure AD - Microsoft identity platform Google - Google OAuth 2.0","title":"Supported Identity Providers"},{"location":"#using-the-mcp-server","text":"","title":"Using the MCP Server"},{"location":"#with-claude-desktop","text":"Add the following to your Claude Desktop configuration ( ~/Library/Application Support/Claude/claude_desktop_config.json on macOS): { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" ] } } }","title":"With Claude Desktop"},{"location":"#with-mcp-remote-oauth","text":"When OAuth is enabled, mcp-remote handles authentication automatically: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" , \"--allow-http\" ] } } } The --allow-http flag is needed for local development. In production with HTTPS, remove this flag.","title":"With mcp-remote (OAuth)"},{"location":"#direct-sse-connection","text":"For clients that support Server-Sent Events directly: http://localhost:5000/mcp/sse","title":"Direct SSE Connection"},{"location":"#available-tools","text":"The MCP server exposes all OGC API endpoints as tools, including: Tool Description getLandingPage Get the API landing page getConformance Get OGC API conformance classes getCollections List all feature collections getCollection Get metadata for a specific collection getItems Query features from a collection getItem Get a specific feature by ID getProcesses List available processes (if OGC API - Processes is enabled)","title":"Available Tools"},{"location":"#oauth-discovery-endpoints","text":"When OAuth is enabled, the following RFC-compliant endpoints are available: Endpoint Description /.well-known/oauth-protected-resource/mcp/ Protected resource metadata (RFC 9728) /mcp/.well-known/oauth-authorization-server Authorization server metadata (RFC 8414)","title":"OAuth Discovery Endpoints"},{"location":"#architecture_1","text":"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Claude Desktop \u2502 \u2502 or MCP Client \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 MCP Protocol (SSE/HTTP) \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 fastgeoapi \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 MCP Server (/mcp) \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 OAuth Proxy \u2502 \u2502 Tool Router \u2502 \u2502 SSE/HTTP \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u25bc \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 pygeoapi OGC API (/geoapi) \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Architecture"},{"location":"#credits","text":"This project was generated from \\@cjolowicz \\'s Hypermodern Python Cookiecutter template.","title":"Credits"},{"location":"getting-started/","text":"Getting started Live Demo Server A public demo server is available for testing and exploration: Demo URL: https://fastgeoapi.fly.dev/geoapi The demo server is protected with OAuth2 client-credentials flow , demonstrating fastgeoapi's security capabilities in a real-world scenario. Obtaining an Access Token To access the demo server, you need to obtain an OAuth2 access token using the client-credentials grant: curl -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\" The response will contain an access_token : { \"access_token\" : \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\" , \"token_type\" : \"Bearer\" , \"expires_in\" : 3600 } Making Authenticated Requests Include the access token in the Authorization header: # Store the token in a variable TOKEN = $( curl -s -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\" \\ | jq -r '.access_token' ) # Landing page curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/?f=json\" # List available collections curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/collections?f=json\" # View conformance classes curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/conformance?f=json\" # Access OpenAPI specification curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/openapi?f=json\" OAuth2 Configuration Details Parameter Value Token Endpoint https://76hxgq.logto.app/oidc/token Grant Type client_credentials Scope openid profile ci Resource http://localhost:5000/geoapi/ The Basic Authentication header contains the base64-encoded client_id:client_secret credentials for the demo application. Development Prerequisites Install UV - a fast Python package installer and resolver: macOS / Linux: curl -sSf https://install.ultraviolet.dev | sh Windows (PowerShell): powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\" Setup After cloning the repository, use UV to install dependencies: git clone https://github.com/geobeyond/fastgeoapi.git cd fastgeoapi uv sync This automatically: Creates a virtual environment in .venv Installs all required dependencies including git-based packages from [tool.uv.sources] Sets up fastgeoapi in development mode For development, UV uses git-based dependencies defined in [tool.uv.sources] to get the latest features from upstream projects (pygeoapi master, pygeofilter, fencer). The PyPI release uses stable published versions. Activate the Virtual Environment macOS / Linux: source .venv/bin/activate Windows (PowerShell): . venv \\ Scripts \\ Activate . ps1 Running fastgeoapi Development workflow This workflow is for contributing to fastgeoapi itself by cloning the repository. Once Keycloak and OPA have been started, configure the required environment variables: export PYGEOAPI_CONFIG = pygeoapi-config.yml export PYGEOAPI_OPENAPI = pygeoapi-openapi.yml export FASTGEOAPI_CONTEXT = '/geoapi' Start fastgeoapi in development mode: uv run fastapi run app/main.py --app app --host 0 .0.0.0 --port 5000 --reload Application workflow This workflow is for using fastgeoapi as a Python package to build your own FastAPI application. Installation Install fastgeoapi in your project: pip install fastgeoapi Or with UV: uv add fastgeoapi Running Your Application When using fastgeoapi as an installed package, you can start the server using the fastgeoapi CLI: fastgeoapi run With options: fastgeoapi run --host 0 .0.0.0 --port 5000 --reload Or using uvicorn directly: uvicorn app.main:app --host 0 .0.0.0 --port 5000 --reload Verifying the Setup Once running, verify the endpoints are accessible: # Landing page curl http://localhost:5000/geoapi/?f = json # OpenAPI specification curl http://localhost:5000/geoapi/openapi?f = json # Collections curl http://localhost:5000/geoapi/collections?f = json # Conformance curl http://localhost:5000/geoapi/conformance?f = json Environment Configuration The following configuration applies to both the Development and Application workflows. fastgeoapi uses environment variables to configure its behavior. The main variable is ENV_STATE which determines whether to load development ( dev ) or production ( prod ) configuration. Create a .env file in your project root: # Environment state: 'dev' or 'prod' ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi Authentication Options The following authentication options apply to both the Development and Application workflows. fastgeoapi supports three mutually exclusive authentication methods. Only one can be enabled at a time. Option 1: No Authentication (Open Access) DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Option 2: API Key Authentication DEV_API_KEY_ENABLED = true DEV_PYGEOAPI_KEY_GLOBAL = your-secret-api-key DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Clients must include the X-API-KEY header in requests: curl -H \"X-API-KEY: your-secret-api-key\" http://localhost:5000/geoapi/collections Option 3: OAuth2/JWKS Authentication DEV_JWKS_ENABLED = true DEV_OAUTH2_JWKS_ENDPOINT = https://your-auth-server/.well-known/jwks.json DEV_OAUTH2_TOKEN_ENDPOINT = https://your-auth-server/oauth/token DEV_API_KEY_ENABLED = false DEV_OPA_ENABLED = false Option 4: Open Policy Agent (OPA) Authorization DEV_OPA_ENABLED = true DEV_OPA_URL = http://localhost:8181 DEV_OIDC_WELL_KNOWN_ENDPOINT = http://localhost:8080/realms/master/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false Startup Flow The following startup flow applies to both the Development and Application workflows. When the application starts, fastgeoapi performs the following steps: Load Configuration : Reads ENV_STATE to determine which configuration to use ( DevConfig or ProdConfig ) Initialize FastAPI : Creates the FastAPI application with CORS middleware Set Pygeoapi Variables : Configures pygeoapi environment variables ( PYGEOAPI_CONFIG , PYGEOAPI_OPENAPI , etc.) Generate OpenAPI : If pygeoapi-openapi.yml doesn't exist, generates it from pygeoapi-config.yml Apply Authentication : Based on configuration, adds the appropriate authentication middleware Mount Pygeoapi : Mounts the pygeoapi application at the configured context path (e.g., /geoapi ) AWS Lambda Deployment The following configuration applies to both the Development and Application workflows. To deploy on AWS Lambda, enable the Mangum handler: DEV_AWS_LAMBDA_DEPLOY = true # Disable log enqueue for Lambda compatibility DEV_LOG_ENQUEUE = false The application automatically creates a handler object compatible with AWS Lambda when AWS_LAMBDA_DEPLOY=true . Example: Complete Application Setup with API Key This example demonstrates how to create a new project using fastgeoapi as a package with API Key authentication. Step 1: Create a new project mkdir my-geoapi-app cd my-geoapi-app uv init --name my-geoapi-app Step 2: Install fastgeoapi uv add fastgeoapi Step 3: Create the pygeoapi configuration Create a pygeoapi-config.yml file with your data sources. Here's a minimal example: server : bind : host : ${HOST} port : ${PORT} url : ${PYGEOAPI_BASEURL}${FASTGEOAPI_CONTEXT} mimetype : application/json; charset=UTF-8 encoding : utf-8 languages : - en-US pretty_print : true limits : default_items : 20 max_items : 50 logging : level : ERROR metadata : identification : title : My GeoAPI Instance description : My geospatial data API keywords : - geospatial - api terms_of_service : https://creativecommons.org/licenses/by/4.0/ url : https://example.org license : name : CC-BY 4.0 license url : https://creativecommons.org/licenses/by/4.0/ provider : name : My Organization url : https://example.org contact : name : Contact Name email : contact@example.org resources : # Add your data sources here Step 4: Create the environment file Create a .env file with all required configuration: # Environment state ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi # API Key authentication DEV_API_KEY_ENABLED = true DEV_PYGEOAPI_KEY_GLOBAL = my-secret-api-key DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Step 5: Start the server # Set the API key environment variable for the middleware export PYGEOAPI_KEY_GLOBAL = my-secret-api-key # Start the server using the fastgeoapi CLI fastgeoapi run # Or with options fastgeoapi run --host 0 .0.0.0 --port 5000 # Alternatively, using uvicorn directly uvicorn app.main:app --host 0 .0.0.0 --port 5000 Step 6: Verify the endpoints Test that the API is running correctly: # OpenAPI specification (public, no auth required) curl http://localhost:5000/geoapi/openapi?f = json # Landing page without API key (should return 401) curl http://localhost:5000/geoapi/?f = json # Response: {\"detail\":\"no api key\"} # Landing page with API key (should return 200) curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/?f = json # Collections with API key curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/collections?f = json # Conformance with API key curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/conformance?f = json Release Workflow This project uses a branching strategy with automated releases via GitHub Actions: \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 develop \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 main \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 PyPI \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 (release) \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 TestPyPI \u2502 \u2502 (dev) \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Branches and Targets Branch Target Description develop TestPyPI Development releases with .dev suffix main PyPI Production releases when version is bumped Development Releases (TestPyPI) Every push to the develop branch triggers automatic publishing to TestPyPI: git checkout develop # Make changes git commit -m \"feat: add new feature\" git push origin develop The workflow automatically: Bumps the version with a .dev suffix (e.g., 0.0.4.dev.1733912345 ) Builds the package Publishes to TestPyPI using trusted publisher You can install the development version: pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple/ fastgeoapi Production Releases (PyPI) To create a production release: Update the version in pyproject.toml (e.g., 0.0.3 \u2192 0.0.4 ) Merge changes to main branch Push to trigger the release workflow # Update version in pyproject.toml git checkout main git merge develop git push origin main The workflow automatically: Detects the version change Creates a git tag (e.g., v0.0.4 ) Builds the package Publishes to PyPI using trusted publisher Creates release notes via Release Drafter Trusted Publisher Both PyPI and TestPyPI publishing use Trusted Publisher (OIDC) for secure, tokenless authentication. This eliminates the need for API tokens and provides better security through short-lived credentials. Production Behind a proxy If the deployment is operated behind a proxy (i.e. Traefik, Nginx, WSO2 Gateway, etc), fastgeoapi provides a reverse proxy configuration to return the pygeoapi links accordingly to the urls called by the users. The configuration is disabled by default with the following configuration PROD_FASTGEOAPI_REVERSE_PROXY=false in the .env file. The most relevant configurations for production in a reverse proxy scenario are: PROD_FASTGEOAPI_CONTEXT : the base path where pygeoapi is operated, i.e. /geoapi PROD_FASTGEOAPI_REVERSE_PROXY : boolean flag to enable or disable the reverse proxy configuration, i.e. true At runtime, if the variable FASTGEOAPI_REVERSE_PROXY has the value true the returned pygeoapi links are dynamic. This means, for example, that a Kubernetes Ingress with multiple hosts might be supported in a transparent way: # snippet example of a kubernetes ingress with multiple hosts spec: rules: - host: public.pygeoapi.io http: paths: - backend: serviceName: fastgeoapi-svc servicePort: 5000 path: /geoapi pathType: ImplementationSpecific - host: private.pygeoapi.io http: paths: - backend: serviceName: fastgeoapi-svc servicePort: 5000 path: /geoapi pathType: ImplementationSpecific If the user calls the public url http://public.pygeoapi.io the response contains the links which respect this base url without the need to have it hard-coded in the pygeoapi configuration pygeoapi-config.yml . # Using a security scheme driven by an api-key curl -H \"X-API-KEY: pygeoapi\" http://public.pygeoapi.io/geoapi/collections/obs { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" } The same result would have been got if a private endpoint is hit, i.e. http://private.pygeoapi.io/geoapi/collections/obs","title":"Getting started"},{"location":"getting-started/#getting-started","text":"","title":"Getting started"},{"location":"getting-started/#live-demo-server","text":"A public demo server is available for testing and exploration: Demo URL: https://fastgeoapi.fly.dev/geoapi The demo server is protected with OAuth2 client-credentials flow , demonstrating fastgeoapi's security capabilities in a real-world scenario.","title":"Live Demo Server"},{"location":"getting-started/#obtaining-an-access-token","text":"To access the demo server, you need to obtain an OAuth2 access token using the client-credentials grant: curl -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\" The response will contain an access_token : { \"access_token\" : \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\" , \"token_type\" : \"Bearer\" , \"expires_in\" : 3600 }","title":"Obtaining an Access Token"},{"location":"getting-started/#making-authenticated-requests","text":"Include the access token in the Authorization header: # Store the token in a variable TOKEN = $( curl -s -X POST https://76hxgq.logto.app/oidc/token \\ -H \"Authorization: Basic czRyZjIzbnlucmNvdGM4NnhuaWVxOlc2RHJhQWJ1MTZnb29yR0xWSE02WFlSUnI4aWpObUww\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=client_credentials&resource=http://localhost:5000/geoapi/&scope=openid profile ci\" \\ | jq -r '.access_token' ) # Landing page curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/?f=json\" # List available collections curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/collections?f=json\" # View conformance classes curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/conformance?f=json\" # Access OpenAPI specification curl -H \"Authorization: Bearer $TOKEN \" \\ \"https://fastgeoapi.fly.dev/geoapi/openapi?f=json\"","title":"Making Authenticated Requests"},{"location":"getting-started/#oauth2-configuration-details","text":"Parameter Value Token Endpoint https://76hxgq.logto.app/oidc/token Grant Type client_credentials Scope openid profile ci Resource http://localhost:5000/geoapi/ The Basic Authentication header contains the base64-encoded client_id:client_secret credentials for the demo application.","title":"OAuth2 Configuration Details"},{"location":"getting-started/#development","text":"","title":"Development"},{"location":"getting-started/#prerequisites","text":"Install UV - a fast Python package installer and resolver: macOS / Linux: curl -sSf https://install.ultraviolet.dev | sh Windows (PowerShell): powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"","title":"Prerequisites"},{"location":"getting-started/#setup","text":"After cloning the repository, use UV to install dependencies: git clone https://github.com/geobeyond/fastgeoapi.git cd fastgeoapi uv sync This automatically: Creates a virtual environment in .venv Installs all required dependencies including git-based packages from [tool.uv.sources] Sets up fastgeoapi in development mode For development, UV uses git-based dependencies defined in [tool.uv.sources] to get the latest features from upstream projects (pygeoapi master, pygeofilter, fencer). The PyPI release uses stable published versions.","title":"Setup"},{"location":"getting-started/#activate-the-virtual-environment","text":"macOS / Linux: source .venv/bin/activate Windows (PowerShell): . venv \\ Scripts \\ Activate . ps1","title":"Activate the Virtual Environment"},{"location":"getting-started/#running-fastgeoapi","text":"","title":"Running fastgeoapi"},{"location":"getting-started/#development-workflow","text":"This workflow is for contributing to fastgeoapi itself by cloning the repository. Once Keycloak and OPA have been started, configure the required environment variables: export PYGEOAPI_CONFIG = pygeoapi-config.yml export PYGEOAPI_OPENAPI = pygeoapi-openapi.yml export FASTGEOAPI_CONTEXT = '/geoapi' Start fastgeoapi in development mode: uv run fastapi run app/main.py --app app --host 0 .0.0.0 --port 5000 --reload","title":"Development workflow"},{"location":"getting-started/#application-workflow","text":"This workflow is for using fastgeoapi as a Python package to build your own FastAPI application.","title":"Application workflow"},{"location":"getting-started/#installation","text":"Install fastgeoapi in your project: pip install fastgeoapi Or with UV: uv add fastgeoapi","title":"Installation"},{"location":"getting-started/#running-your-application","text":"When using fastgeoapi as an installed package, you can start the server using the fastgeoapi CLI: fastgeoapi run With options: fastgeoapi run --host 0 .0.0.0 --port 5000 --reload Or using uvicorn directly: uvicorn app.main:app --host 0 .0.0.0 --port 5000 --reload","title":"Running Your Application"},{"location":"getting-started/#verifying-the-setup","text":"Once running, verify the endpoints are accessible: # Landing page curl http://localhost:5000/geoapi/?f = json # OpenAPI specification curl http://localhost:5000/geoapi/openapi?f = json # Collections curl http://localhost:5000/geoapi/collections?f = json # Conformance curl http://localhost:5000/geoapi/conformance?f = json","title":"Verifying the Setup"},{"location":"getting-started/#environment-configuration","text":"The following configuration applies to both the Development and Application workflows. fastgeoapi uses environment variables to configure its behavior. The main variable is ENV_STATE which determines whether to load development ( dev ) or production ( prod ) configuration. Create a .env file in your project root: # Environment state: 'dev' or 'prod' ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi","title":"Environment Configuration"},{"location":"getting-started/#authentication-options","text":"The following authentication options apply to both the Development and Application workflows. fastgeoapi supports three mutually exclusive authentication methods. Only one can be enabled at a time. Option 1: No Authentication (Open Access) DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Option 2: API Key Authentication DEV_API_KEY_ENABLED = true DEV_PYGEOAPI_KEY_GLOBAL = your-secret-api-key DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false Clients must include the X-API-KEY header in requests: curl -H \"X-API-KEY: your-secret-api-key\" http://localhost:5000/geoapi/collections Option 3: OAuth2/JWKS Authentication DEV_JWKS_ENABLED = true DEV_OAUTH2_JWKS_ENDPOINT = https://your-auth-server/.well-known/jwks.json DEV_OAUTH2_TOKEN_ENDPOINT = https://your-auth-server/oauth/token DEV_API_KEY_ENABLED = false DEV_OPA_ENABLED = false Option 4: Open Policy Agent (OPA) Authorization DEV_OPA_ENABLED = true DEV_OPA_URL = http://localhost:8181 DEV_OIDC_WELL_KNOWN_ENDPOINT = http://localhost:8080/realms/master/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false","title":"Authentication Options"},{"location":"getting-started/#startup-flow","text":"The following startup flow applies to both the Development and Application workflows. When the application starts, fastgeoapi performs the following steps: Load Configuration : Reads ENV_STATE to determine which configuration to use ( DevConfig or ProdConfig ) Initialize FastAPI : Creates the FastAPI application with CORS middleware Set Pygeoapi Variables : Configures pygeoapi environment variables ( PYGEOAPI_CONFIG , PYGEOAPI_OPENAPI , etc.) Generate OpenAPI : If pygeoapi-openapi.yml doesn't exist, generates it from pygeoapi-config.yml Apply Authentication : Based on configuration, adds the appropriate authentication middleware Mount Pygeoapi : Mounts the pygeoapi application at the configured context path (e.g., /geoapi )","title":"Startup Flow"},{"location":"getting-started/#aws-lambda-deployment","text":"The following configuration applies to both the Development and Application workflows. To deploy on AWS Lambda, enable the Mangum handler: DEV_AWS_LAMBDA_DEPLOY = true # Disable log enqueue for Lambda compatibility DEV_LOG_ENQUEUE = false The application automatically creates a handler object compatible with AWS Lambda when AWS_LAMBDA_DEPLOY=true .","title":"AWS Lambda Deployment"},{"location":"getting-started/#example-complete-application-setup-with-api-key","text":"This example demonstrates how to create a new project using fastgeoapi as a package with API Key authentication.","title":"Example: Complete Application Setup with API Key"},{"location":"getting-started/#step-1-create-a-new-project","text":"mkdir my-geoapi-app cd my-geoapi-app uv init --name my-geoapi-app","title":"Step 1: Create a new project"},{"location":"getting-started/#step-2-install-fastgeoapi","text":"uv add fastgeoapi","title":"Step 2: Install fastgeoapi"},{"location":"getting-started/#step-3-create-the-pygeoapi-configuration","text":"Create a pygeoapi-config.yml file with your data sources. Here's a minimal example: server : bind : host : ${HOST} port : ${PORT} url : ${PYGEOAPI_BASEURL}${FASTGEOAPI_CONTEXT} mimetype : application/json; charset=UTF-8 encoding : utf-8 languages : - en-US pretty_print : true limits : default_items : 20 max_items : 50 logging : level : ERROR metadata : identification : title : My GeoAPI Instance description : My geospatial data API keywords : - geospatial - api terms_of_service : https://creativecommons.org/licenses/by/4.0/ url : https://example.org license : name : CC-BY 4.0 license url : https://creativecommons.org/licenses/by/4.0/ provider : name : My Organization url : https://example.org contact : name : Contact Name email : contact@example.org resources : # Add your data sources here","title":"Step 3: Create the pygeoapi configuration"},{"location":"getting-started/#step-4-create-the-environment-file","text":"Create a .env file with all required configuration: # Environment state ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Logging (required) DEV_LOG_PATH = /tmp DEV_LOG_FILENAME = fastgeoapi.log DEV_LOG_LEVEL = debug DEV_LOG_ENQUEUE = true DEV_LOG_ROTATION = 1 days DEV_LOG_RETENTION = 1 months # Pygeoapi configuration DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_FASTGEOAPI_CONTEXT = /geoapi # API Key authentication DEV_API_KEY_ENABLED = true DEV_PYGEOAPI_KEY_GLOBAL = my-secret-api-key DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false","title":"Step 4: Create the environment file"},{"location":"getting-started/#step-5-start-the-server","text":"# Set the API key environment variable for the middleware export PYGEOAPI_KEY_GLOBAL = my-secret-api-key # Start the server using the fastgeoapi CLI fastgeoapi run # Or with options fastgeoapi run --host 0 .0.0.0 --port 5000 # Alternatively, using uvicorn directly uvicorn app.main:app --host 0 .0.0.0 --port 5000","title":"Step 5: Start the server"},{"location":"getting-started/#step-6-verify-the-endpoints","text":"Test that the API is running correctly: # OpenAPI specification (public, no auth required) curl http://localhost:5000/geoapi/openapi?f = json # Landing page without API key (should return 401) curl http://localhost:5000/geoapi/?f = json # Response: {\"detail\":\"no api key\"} # Landing page with API key (should return 200) curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/?f = json # Collections with API key curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/collections?f = json # Conformance with API key curl -H \"X-API-KEY: my-secret-api-key\" http://localhost:5000/geoapi/conformance?f = json","title":"Step 6: Verify the endpoints"},{"location":"getting-started/#release-workflow","text":"This project uses a branching strategy with automated releases via GitHub Actions: \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 develop \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 main \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 PyPI \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 (release) \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 TestPyPI \u2502 \u2502 (dev) \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518","title":"Release Workflow"},{"location":"getting-started/#branches-and-targets","text":"Branch Target Description develop TestPyPI Development releases with .dev suffix main PyPI Production releases when version is bumped","title":"Branches and Targets"},{"location":"getting-started/#development-releases-testpypi","text":"Every push to the develop branch triggers automatic publishing to TestPyPI: git checkout develop # Make changes git commit -m \"feat: add new feature\" git push origin develop The workflow automatically: Bumps the version with a .dev suffix (e.g., 0.0.4.dev.1733912345 ) Builds the package Publishes to TestPyPI using trusted publisher You can install the development version: pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple/ fastgeoapi","title":"Development Releases (TestPyPI)"},{"location":"getting-started/#production-releases-pypi","text":"To create a production release: Update the version in pyproject.toml (e.g., 0.0.3 \u2192 0.0.4 ) Merge changes to main branch Push to trigger the release workflow # Update version in pyproject.toml git checkout main git merge develop git push origin main The workflow automatically: Detects the version change Creates a git tag (e.g., v0.0.4 ) Builds the package Publishes to PyPI using trusted publisher Creates release notes via Release Drafter","title":"Production Releases (PyPI)"},{"location":"getting-started/#trusted-publisher","text":"Both PyPI and TestPyPI publishing use Trusted Publisher (OIDC) for secure, tokenless authentication. This eliminates the need for API tokens and provides better security through short-lived credentials.","title":"Trusted Publisher"},{"location":"getting-started/#production","text":"","title":"Production"},{"location":"getting-started/#behind-a-proxy","text":"If the deployment is operated behind a proxy (i.e. Traefik, Nginx, WSO2 Gateway, etc), fastgeoapi provides a reverse proxy configuration to return the pygeoapi links accordingly to the urls called by the users. The configuration is disabled by default with the following configuration PROD_FASTGEOAPI_REVERSE_PROXY=false in the .env file. The most relevant configurations for production in a reverse proxy scenario are: PROD_FASTGEOAPI_CONTEXT : the base path where pygeoapi is operated, i.e. /geoapi PROD_FASTGEOAPI_REVERSE_PROXY : boolean flag to enable or disable the reverse proxy configuration, i.e. true At runtime, if the variable FASTGEOAPI_REVERSE_PROXY has the value true the returned pygeoapi links are dynamic. This means, for example, that a Kubernetes Ingress with multiple hosts might be supported in a transparent way: # snippet example of a kubernetes ingress with multiple hosts spec: rules: - host: public.pygeoapi.io http: paths: - backend: serviceName: fastgeoapi-svc servicePort: 5000 path: /geoapi pathType: ImplementationSpecific - host: private.pygeoapi.io http: paths: - backend: serviceName: fastgeoapi-svc servicePort: 5000 path: /geoapi pathType: ImplementationSpecific If the user calls the public url http://public.pygeoapi.io the response contains the links which respect this base url without the need to have it hard-coded in the pygeoapi configuration pygeoapi-config.yml . # Using a security scheme driven by an api-key curl -H \"X-API-KEY: pygeoapi\" http://public.pygeoapi.io/geoapi/collections/obs { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://public.pygeoapi.io/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" } The same result would have been got if a private endpoint is hit, i.e. http://private.pygeoapi.io/geoapi/collections/obs","title":"Behind a proxy"},{"location":"howto-guides/","text":"How-to Guides This section contains practical guides for configuring and using fastgeoapi features. Configure Identity and Access Management TBD Run Keycloak and Open Policy Agent TBD Configure the MCP Server fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server provides: Automatic Tool Generation from the OGC API OpenAPI specification OAuth Authentication with any OIDC-compliant provider Dynamic Client Registration for seamless integration with MCP clients SSE Transport for real-time communication For complete configuration instructions, security flows, and usage examples, see the dedicated MCP Server guide .","title":"Overview"},{"location":"howto-guides/#how-to-guides","text":"This section contains practical guides for configuring and using fastgeoapi features.","title":"How-to Guides"},{"location":"howto-guides/#configure-identity-and-access-management","text":"TBD","title":"Configure Identity and Access Management"},{"location":"howto-guides/#run-keycloak-and-open-policy-agent","text":"TBD","title":"Run Keycloak and Open Policy Agent"},{"location":"howto-guides/#configure-the-mcp-server","text":"fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server provides: Automatic Tool Generation from the OGC API OpenAPI specification OAuth Authentication with any OIDC-compliant provider Dynamic Client Registration for seamless integration with MCP clients SSE Transport for real-time communication For complete configuration instructions, security flows, and usage examples, see the dedicated MCP Server guide .","title":"Configure the MCP Server"},{"location":"mcp-server/","text":"MCP Server (Model Context Protocol) fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server is built using FastMCP and automatically generates tools from the pygeoapi OpenAPI specification. What is MCP? The Model Context Protocol (MCP) is an open standard that enables AI assistants to interact with external tools and data sources. By implementing an MCP server, fastgeoapi allows AI assistants like Claude Desktop to: Query geospatial feature collections Retrieve metadata about available datasets Execute OGC API processes Access conformance information Features Feature Description Automatic Tool Generation Tools are generated from the OGC API OpenAPI spec OAuth Authentication Supports OIDC authentication with any OAuth provider RFC 9728 Compliant Implements OAuth 2.0 Protected Resource Metadata Dynamic Client Registration Compatible with mcp-remote and other MCP clients Provider Agnostic Uses mcpauth for multi-IdP support SSE Transport Server-Sent Events for real-time communication Enable the MCP Server To enable the MCP server, set the FASTGEOAPI_WITH_MCP environment variable in your .env file: # For development DEV_FASTGEOAPI_WITH_MCP = true # For production PROD_FASTGEOAPI_WITH_MCP = true The MCP server will be mounted at the /mcp endpoint. Configuration Basic Configuration (No Authentication) For development or internal use without authentication: # .env file ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Enable MCP DEV_FASTGEOAPI_WITH_MCP = true # Pygeoapi configuration DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_FASTGEOAPI_CONTEXT = /geoapi # Disable authentication DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false With OAuth Authentication To enable OAuth authentication for the MCP server, configure JWKS with your OIDC provider: # .env file ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Enable MCP with OAuth DEV_FASTGEOAPI_WITH_MCP = true DEV_JWKS_ENABLED = true # OIDC Configuration DEV_OIDC_WELL_KNOWN_ENDPOINT = https://your-idp.example.com/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret # Pygeoapi configuration DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_FASTGEOAPI_CONTEXT = /geoapi # Disable other auth methods DEV_API_KEY_ENABLED = false DEV_OPA_ENABLED = false Security & Authentication Flows The MCP server supports multiple security configurations depending on your deployment needs. Supported OAuth 2.0 Flows Flow Use Case Configuration Authorization Code + PKCE Interactive clients (Claude Desktop, mcp-remote) JWKS_ENABLED=true with OIDC config Client Credentials Machine-to-machine, service accounts JWKS_ENABLED=true with OIDC config Dynamic Client Registration (DCR) Auto-registration for MCP clients Enabled automatically with OIDC OAuth Proxy Architecture When OAuth is enabled, the MCP server acts as an OAuth Proxy . This architecture allows the MCP server to handle OAuth flows on behalf of MCP clients, simplifying authentication for AI assistants. \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 MCP Client \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 MCP Server \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Identity \u2502 \u2502 (mcp-remote) \u2502 \u2502 (OAuth Proxy) \u2502 \u2502 Provider \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 1. Discovery \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 /.well-known/... \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 2. DCR (register) \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 3. Authorization \u2502 4. Redirect to IdP \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 5. Auth Code \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 6. Token Exchange \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 7. MCP Requests \u2502 8. Internal API call \u2502 \u2502 (with Bearer token) \u2502 (bypasses auth) \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 OAuth Flow Steps: Discovery : The MCP client fetches OAuth metadata from /.well-known/oauth-protected-resource/mcp/ Dynamic Client Registration : The client registers itself with the MCP server's OAuth proxy Authorization Request : The client initiates the OAuth flow IdP Redirect : The OAuth proxy redirects to the upstream Identity Provider Auth Code Return : The IdP returns an authorization code Token Exchange : The OAuth proxy exchanges the code for tokens and issues its own JWT MCP Requests : The client makes authenticated MCP requests with the Bearer token Internal API Calls : The MCP server calls pygeoapi with an internal bypass key RFC Compliance The MCP server implements several OAuth-related RFCs: RFC Title Description RFC 8414 OAuth 2.0 Authorization Server Metadata Enables automatic discovery of OAuth endpoints RFC 9728 OAuth 2.0 Protected Resource Metadata Describes protected resources and required scopes RFC 7636 Proof Key for Code Exchange (PKCE) Prevents authorization code interception attacks RFC 7591 OAuth 2.0 Dynamic Client Registration Allows clients to register automatically RFC 6750 Bearer Token Usage Proper error handling for authentication failures Security Features Feature Description JWT Validation Tokens are validated using JWKS from the IdP Opaque Token Support Supports IdPs that return opaque tokens (e.g., Logto without API Resources) RFC 6750 Compliance Proper error handling distinguishing \"no token\" vs \"invalid token\" Internal API Bypass MCP-to-pygeoapi calls use an internal key to bypass authentication Scope Validation Configurable required scopes for access control PKCE Support Prevents authorization code interception in public clients Supported Identity Providers The MCP server is provider-agnostic and works with any OIDC-compliant Identity Provider: Provider Status Notes Logto Tested OAuth proxy with DCR, opaque token support Auth0 Supported Full OIDC support Keycloak Supported Full OIDC and OPA integration Okta Supported Standard OIDC flows Azure AD Supported Microsoft identity platform Google Supported Google OAuth 2.0 Using the MCP Server Connect Claude Desktop Claude Desktop supports MCP servers natively. Add the following to your configuration file: macOS : ~/Library/Application Support/Claude/claude_desktop_config.json Windows : %APPDATA%\\Claude\\claude_desktop_config.json Without Authentication { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" ] } } } With OAuth Authentication When OAuth is enabled, mcp-remote handles authentication automatically: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" , \"--allow-http\" ] } } } HTTP Flag The --allow-http flag is required for local development. In production with HTTPS, remove this flag. Production Configuration For production deployments with HTTPS: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"https://your-domain.com/mcp/\" ] } } } Connect via Direct SSE For clients that support Server-Sent Events directly, connect to: http://localhost:5000/mcp/sse Or with HTTPS in production: https://your-domain.com/mcp/sse Test the MCP Server You can test the MCP server endpoints directly: # Check if MCP server is running (SSE endpoint) curl -N http://localhost:5000/mcp/sse # Get OAuth metadata (when OAuth is enabled) curl http://localhost:5000/.well-known/oauth-protected-resource/mcp/ # Get authorization server metadata curl http://localhost:5000/mcp/.well-known/oauth-authorization-server Available MCP Tools The MCP server automatically generates tools from the pygeoapi OpenAPI specification. The available tools depend on your pygeoapi configuration and enabled OGC API standards. Core OGC API Tools Tool Description OGC API getLandingPage Get the API landing page with links to all resources Common getConformance Get OGC API conformance classes Common getCollections List all available feature collections Features getCollection Get metadata for a specific collection Features getItems Query features from a collection with filters Features getItem Get a specific feature by ID Features getQueryables Get queryable properties for a collection Features OGC API - Processes Tools If OGC API - Processes is enabled in your pygeoapi configuration: Tool Description getProcesses List all available processes getProcess Get details about a specific process executeProcess Execute a process with input parameters getJob Get the status of a job getJobResults Get the results of a completed job Example Tool Usage When using Claude Desktop with the MCP server, you can ask questions like: \"What feature collections are available?\" \"Show me the first 10 features from the 'lakes' collection\" \"What are the queryable properties for the 'buildings' collection?\" \"Get the feature with ID 'building-123' from the buildings collection\" Claude will automatically use the appropriate MCP tools to fulfill these requests. OAuth Discovery Endpoints When OAuth is enabled, the following RFC-compliant endpoints are available: Endpoint RFC Description /.well-known/oauth-protected-resource/mcp/ RFC 9728 Protected resource metadata /mcp/.well-known/oauth-authorization-server RFC 8414 Authorization server metadata /mcp/register RFC 7591 Dynamic client registration /mcp/authorize OAuth 2.0 Authorization endpoint /mcp/token OAuth 2.0 Token endpoint Architecture The following diagram shows how the MCP server integrates with the fastgeoapi architecture: \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Claude Desktop \u2502 \u2502 or MCP Client \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 MCP Protocol (SSE/HTTP) \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 fastgeoapi \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 MCP Server (/mcp) \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 OAuth Proxy \u2502 \u2502 Tool Router \u2502 \u2502 SSE Transport \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - DCR \u2502 \u2502 - OpenAPI \u2502 \u2502 - Bidirectional \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - PKCE \u2502 \u2502 parsing \u2502 \u2502 communication \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - Token mgmt \u2502 \u2502 - Tool gen \u2502 \u2502 - Event stream \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Internal API calls \u2502 \u2502 \u2502 (X-MCP-Internal-Key header) \u2502 \u2502 \u25bc \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 pygeoapi OGC API (/geoapi) \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 Features \u2502 \u2502 Processes \u2502 \u2502 Collections \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Component Responsibilities: Component Responsibility OAuth Proxy Handles OAuth flows, DCR, PKCE, and token management Tool Router Parses OpenAPI spec and routes tool calls to API endpoints SSE Transport Manages bidirectional communication with MCP clients Internal Key Bypasses authentication for MCP-to-pygeoapi calls Troubleshooting MCP Server Not Starting If the MCP server doesn't start, check: FASTGEOAPI_WITH_MCP=true is set in your .env file The pygeoapi-openapi.yml file exists and is valid Check the logs for any OpenAPI parsing errors # Check if OpenAPI file exists ls -la pygeoapi-openapi.yml # Start with debug logging DEV_LOG_LEVEL = debug fastgeoapi run OAuth Authentication Failing If OAuth authentication fails: Verify your OIDC well-known endpoint is accessible: curl https://your-idp.example.com/.well-known/openid-configuration Check that client ID and secret are correct Ensure the redirect URI is configured in your IdP: For local development: http://localhost:5000/mcp/callback For production: https://your-domain.com/mcp/callback mcp-remote Connection Issues If mcp-remote can't connect: Ensure the MCP server is running and accessible Check that the URL ends with a trailing slash: http://localhost:5000/mcp/ For HTTP (non-HTTPS), use the --allow-http flag Check for CORS issues in browser-based clients Enable Debug Logging Enable debug logging to see detailed MCP server activity: # In .env file DEV_LOG_LEVEL = debug This will show: OAuth flow steps Tool invocations API calls to pygeoapi Token validation results References Model Context Protocol Specification FastMCP Documentation mcpauth Library OAuth 2.0 RFC 6749 OAuth 2.0 Protected Resource Metadata RFC 9728 OGC API Standards","title":"MCP Server"},{"location":"mcp-server/#mcp-server-model-context-protocol","text":"fastgeoapi includes an optional integrated MCP server that exposes OGC API endpoints as tools for AI assistants and LLM-based applications. The MCP server is built using FastMCP and automatically generates tools from the pygeoapi OpenAPI specification.","title":"MCP Server (Model Context Protocol)"},{"location":"mcp-server/#what-is-mcp","text":"The Model Context Protocol (MCP) is an open standard that enables AI assistants to interact with external tools and data sources. By implementing an MCP server, fastgeoapi allows AI assistants like Claude Desktop to: Query geospatial feature collections Retrieve metadata about available datasets Execute OGC API processes Access conformance information","title":"What is MCP?"},{"location":"mcp-server/#features","text":"Feature Description Automatic Tool Generation Tools are generated from the OGC API OpenAPI spec OAuth Authentication Supports OIDC authentication with any OAuth provider RFC 9728 Compliant Implements OAuth 2.0 Protected Resource Metadata Dynamic Client Registration Compatible with mcp-remote and other MCP clients Provider Agnostic Uses mcpauth for multi-IdP support SSE Transport Server-Sent Events for real-time communication","title":"Features"},{"location":"mcp-server/#enable-the-mcp-server","text":"To enable the MCP server, set the FASTGEOAPI_WITH_MCP environment variable in your .env file: # For development DEV_FASTGEOAPI_WITH_MCP = true # For production PROD_FASTGEOAPI_WITH_MCP = true The MCP server will be mounted at the /mcp endpoint.","title":"Enable the MCP Server"},{"location":"mcp-server/#configuration","text":"","title":"Configuration"},{"location":"mcp-server/#basic-configuration-no-authentication","text":"For development or internal use without authentication: # .env file ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Enable MCP DEV_FASTGEOAPI_WITH_MCP = true # Pygeoapi configuration DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_FASTGEOAPI_CONTEXT = /geoapi # Disable authentication DEV_API_KEY_ENABLED = false DEV_JWKS_ENABLED = false DEV_OPA_ENABLED = false","title":"Basic Configuration (No Authentication)"},{"location":"mcp-server/#with-oauth-authentication","text":"To enable OAuth authentication for the MCP server, configure JWKS with your OIDC provider: # .env file ENV_STATE = dev # Server configuration HOST = 0 .0.0.0 PORT = 5000 # Enable MCP with OAuth DEV_FASTGEOAPI_WITH_MCP = true DEV_JWKS_ENABLED = true # OIDC Configuration DEV_OIDC_WELL_KNOWN_ENDPOINT = https://your-idp.example.com/.well-known/openid-configuration DEV_OIDC_CLIENT_ID = your-client-id DEV_OIDC_CLIENT_SECRET = your-client-secret # Pygeoapi configuration DEV_PYGEOAPI_CONFIG = pygeoapi-config.yml DEV_PYGEOAPI_OPENAPI = pygeoapi-openapi.yml DEV_PYGEOAPI_BASEURL = http://localhost:5000 DEV_FASTGEOAPI_CONTEXT = /geoapi # Disable other auth methods DEV_API_KEY_ENABLED = false DEV_OPA_ENABLED = false","title":"With OAuth Authentication"},{"location":"mcp-server/#security-authentication-flows","text":"The MCP server supports multiple security configurations depending on your deployment needs.","title":"Security &amp; Authentication Flows"},{"location":"mcp-server/#supported-oauth-20-flows","text":"Flow Use Case Configuration Authorization Code + PKCE Interactive clients (Claude Desktop, mcp-remote) JWKS_ENABLED=true with OIDC config Client Credentials Machine-to-machine, service accounts JWKS_ENABLED=true with OIDC config Dynamic Client Registration (DCR) Auto-registration for MCP clients Enabled automatically with OIDC","title":"Supported OAuth 2.0 Flows"},{"location":"mcp-server/#oauth-proxy-architecture","text":"When OAuth is enabled, the MCP server acts as an OAuth Proxy . This architecture allows the MCP server to handle OAuth flows on behalf of MCP clients, simplifying authentication for AI assistants. \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 MCP Client \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 MCP Server \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Identity \u2502 \u2502 (mcp-remote) \u2502 \u2502 (OAuth Proxy) \u2502 \u2502 Provider \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 1. Discovery \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 /.well-known/... \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 2. DCR (register) \u2502 \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 3. Authorization \u2502 4. Redirect to IdP \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 5. Auth Code \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 6. Token Exchange \u2502 \u2502 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 \u2502 \u2502 \u2502 \u2502 7. MCP Requests \u2502 8. Internal API call \u2502 \u2502 (with Bearer token) \u2502 (bypasses auth) \u2502 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 OAuth Flow Steps: Discovery : The MCP client fetches OAuth metadata from /.well-known/oauth-protected-resource/mcp/ Dynamic Client Registration : The client registers itself with the MCP server's OAuth proxy Authorization Request : The client initiates the OAuth flow IdP Redirect : The OAuth proxy redirects to the upstream Identity Provider Auth Code Return : The IdP returns an authorization code Token Exchange : The OAuth proxy exchanges the code for tokens and issues its own JWT MCP Requests : The client makes authenticated MCP requests with the Bearer token Internal API Calls : The MCP server calls pygeoapi with an internal bypass key","title":"OAuth Proxy Architecture"},{"location":"mcp-server/#rfc-compliance","text":"The MCP server implements several OAuth-related RFCs: RFC Title Description RFC 8414 OAuth 2.0 Authorization Server Metadata Enables automatic discovery of OAuth endpoints RFC 9728 OAuth 2.0 Protected Resource Metadata Describes protected resources and required scopes RFC 7636 Proof Key for Code Exchange (PKCE) Prevents authorization code interception attacks RFC 7591 OAuth 2.0 Dynamic Client Registration Allows clients to register automatically RFC 6750 Bearer Token Usage Proper error handling for authentication failures","title":"RFC Compliance"},{"location":"mcp-server/#security-features","text":"Feature Description JWT Validation Tokens are validated using JWKS from the IdP Opaque Token Support Supports IdPs that return opaque tokens (e.g., Logto without API Resources) RFC 6750 Compliance Proper error handling distinguishing \"no token\" vs \"invalid token\" Internal API Bypass MCP-to-pygeoapi calls use an internal key to bypass authentication Scope Validation Configurable required scopes for access control PKCE Support Prevents authorization code interception in public clients","title":"Security Features"},{"location":"mcp-server/#supported-identity-providers","text":"The MCP server is provider-agnostic and works with any OIDC-compliant Identity Provider: Provider Status Notes Logto Tested OAuth proxy with DCR, opaque token support Auth0 Supported Full OIDC support Keycloak Supported Full OIDC and OPA integration Okta Supported Standard OIDC flows Azure AD Supported Microsoft identity platform Google Supported Google OAuth 2.0","title":"Supported Identity Providers"},{"location":"mcp-server/#using-the-mcp-server","text":"","title":"Using the MCP Server"},{"location":"mcp-server/#connect-claude-desktop","text":"Claude Desktop supports MCP servers natively. Add the following to your configuration file: macOS : ~/Library/Application Support/Claude/claude_desktop_config.json Windows : %APPDATA%\\Claude\\claude_desktop_config.json","title":"Connect Claude Desktop"},{"location":"mcp-server/#without-authentication","text":"{ \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" ] } } }","title":"Without Authentication"},{"location":"mcp-server/#with-oauth-authentication_1","text":"When OAuth is enabled, mcp-remote handles authentication automatically: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"http://localhost:5000/mcp/\" , \"--allow-http\" ] } } } HTTP Flag The --allow-http flag is required for local development. In production with HTTPS, remove this flag.","title":"With OAuth Authentication"},{"location":"mcp-server/#production-configuration","text":"For production deployments with HTTPS: { \"mcpServers\" : { \"fastgeoapi\" : { \"command\" : \"npx\" , \"args\" : [ \"mcp-remote\" , \"https://your-domain.com/mcp/\" ] } } }","title":"Production Configuration"},{"location":"mcp-server/#connect-via-direct-sse","text":"For clients that support Server-Sent Events directly, connect to: http://localhost:5000/mcp/sse Or with HTTPS in production: https://your-domain.com/mcp/sse","title":"Connect via Direct SSE"},{"location":"mcp-server/#test-the-mcp-server","text":"You can test the MCP server endpoints directly: # Check if MCP server is running (SSE endpoint) curl -N http://localhost:5000/mcp/sse # Get OAuth metadata (when OAuth is enabled) curl http://localhost:5000/.well-known/oauth-protected-resource/mcp/ # Get authorization server metadata curl http://localhost:5000/mcp/.well-known/oauth-authorization-server","title":"Test the MCP Server"},{"location":"mcp-server/#available-mcp-tools","text":"The MCP server automatically generates tools from the pygeoapi OpenAPI specification. The available tools depend on your pygeoapi configuration and enabled OGC API standards.","title":"Available MCP Tools"},{"location":"mcp-server/#core-ogc-api-tools","text":"Tool Description OGC API getLandingPage Get the API landing page with links to all resources Common getConformance Get OGC API conformance classes Common getCollections List all available feature collections Features getCollection Get metadata for a specific collection Features getItems Query features from a collection with filters Features getItem Get a specific feature by ID Features getQueryables Get queryable properties for a collection Features","title":"Core OGC API Tools"},{"location":"mcp-server/#ogc-api-processes-tools","text":"If OGC API - Processes is enabled in your pygeoapi configuration: Tool Description getProcesses List all available processes getProcess Get details about a specific process executeProcess Execute a process with input parameters getJob Get the status of a job getJobResults Get the results of a completed job","title":"OGC API - Processes Tools"},{"location":"mcp-server/#example-tool-usage","text":"When using Claude Desktop with the MCP server, you can ask questions like: \"What feature collections are available?\" \"Show me the first 10 features from the 'lakes' collection\" \"What are the queryable properties for the 'buildings' collection?\" \"Get the feature with ID 'building-123' from the buildings collection\" Claude will automatically use the appropriate MCP tools to fulfill these requests.","title":"Example Tool Usage"},{"location":"mcp-server/#oauth-discovery-endpoints","text":"When OAuth is enabled, the following RFC-compliant endpoints are available: Endpoint RFC Description /.well-known/oauth-protected-resource/mcp/ RFC 9728 Protected resource metadata /mcp/.well-known/oauth-authorization-server RFC 8414 Authorization server metadata /mcp/register RFC 7591 Dynamic client registration /mcp/authorize OAuth 2.0 Authorization endpoint /mcp/token OAuth 2.0 Token endpoint","title":"OAuth Discovery Endpoints"},{"location":"mcp-server/#architecture","text":"The following diagram shows how the MCP server integrates with the fastgeoapi architecture: \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 Claude Desktop \u2502 \u2502 or MCP Client \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 MCP Protocol (SSE/HTTP) \u25bc \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 fastgeoapi \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 MCP Server (/mcp) \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 OAuth Proxy \u2502 \u2502 Tool Router \u2502 \u2502 SSE Transport \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - DCR \u2502 \u2502 - OpenAPI \u2502 \u2502 - Bidirectional \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - PKCE \u2502 \u2502 parsing \u2502 \u2502 communication \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 - Token mgmt \u2502 \u2502 - Tool gen \u2502 \u2502 - Event stream \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Internal API calls \u2502 \u2502 \u2502 (X-MCP-Internal-Key header) \u2502 \u2502 \u25bc \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 pygeoapi OGC API (/geoapi) \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502 \u2502 \u2502 Features \u2502 \u2502 Processes \u2502 \u2502 Collections \u2502 \u2502 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Component Responsibilities: Component Responsibility OAuth Proxy Handles OAuth flows, DCR, PKCE, and token management Tool Router Parses OpenAPI spec and routes tool calls to API endpoints SSE Transport Manages bidirectional communication with MCP clients Internal Key Bypasses authentication for MCP-to-pygeoapi calls","title":"Architecture"},{"location":"mcp-server/#troubleshooting","text":"","title":"Troubleshooting"},{"location":"mcp-server/#mcp-server-not-starting","text":"If the MCP server doesn't start, check: FASTGEOAPI_WITH_MCP=true is set in your .env file The pygeoapi-openapi.yml file exists and is valid Check the logs for any OpenAPI parsing errors # Check if OpenAPI file exists ls -la pygeoapi-openapi.yml # Start with debug logging DEV_LOG_LEVEL = debug fastgeoapi run","title":"MCP Server Not Starting"},{"location":"mcp-server/#oauth-authentication-failing","text":"If OAuth authentication fails: Verify your OIDC well-known endpoint is accessible: curl https://your-idp.example.com/.well-known/openid-configuration Check that client ID and secret are correct Ensure the redirect URI is configured in your IdP: For local development: http://localhost:5000/mcp/callback For production: https://your-domain.com/mcp/callback","title":"OAuth Authentication Failing"},{"location":"mcp-server/#mcp-remote-connection-issues","text":"If mcp-remote can't connect: Ensure the MCP server is running and accessible Check that the URL ends with a trailing slash: http://localhost:5000/mcp/ For HTTP (non-HTTPS), use the --allow-http flag Check for CORS issues in browser-based clients","title":"mcp-remote Connection Issues"},{"location":"mcp-server/#enable-debug-logging","text":"Enable debug logging to see detailed MCP server activity: # In .env file DEV_LOG_LEVEL = debug This will show: OAuth flow steps Tool invocations API calls to pygeoapi Token validation results","title":"Enable Debug Logging"},{"location":"mcp-server/#references","text":"Model Context Protocol Specification FastMCP Documentation mcpauth Library OAuth 2.0 RFC 6749 OAuth 2.0 Protected Resource Metadata RFC 9728 OGC API Standards","title":"References"},{"location":"openapi/","text":"Live Demo OpenAPI","title":"OpenAPI"},{"location":"openapi/#live-demo-openapi","text":"","title":"Live Demo OpenAPI"},{"location":"tutorials/","text":"Tutorials Authentication and Authorization Familiarize with the topic If you don't have prior experience with the topic, we recommend reading Authentication and Authorization in Applications , which is a really good introduction on the difference between Authentication and Authorization that helps you understand how they focus on two different purposes. This tutorial aims to guide the user to configure fastgeoapi with a mechanism that fits with your security requirements. The tool supports different security schemes for OGC APIs served by pygeoapi and allows optionally to enable a coarse or fine-grade authorization for a collection and the endpoints based on user needs and use cases. Supported security schemes are: API KEY : mostly used for machine to machine communication where a static shared secret can be kept secured or for internal interactions among microservices; OAuth2 : commonly used for authorization to accessing resources between two systems and also for stronger machine to machine communication with external parties when a secret needs to be rotated; OpenID Connect : It looks like very similar to OAuth2 and in fact it is built on top of that. It allows to identify and authenticate a user in mobile and Single-Page Application (SPA). OAuth2 vs OpenID Connect It is beneficial to clarify that they serve two different purposes. OAuth2 is a framework for Authorization while OpenID Connect is a protocol for Authentication . If you would like to develop further the concepts then this is an appropriate read. Configure and protect pygeoapi The protection mechanisms introduced above are mutually exclusive and they apply to the whole pygeoapi application that is wrapped by fastgeoapi . The configuration happens in the .env file where the environment variables for development and production are defined. As explained in the getting-started section their prefix identifies the target environment (i.e. DEV_ vs PROD_ ). Let's go through the different mechanisms. Please make sure to have cloned the repo before starting the following sections. Also, it is supposed to having set the environment for development with ENV_STATE=dev in the .env file. API KEY The security configuration, in this case, can be enabled with these two additional settings: # api-keys DEV_API_KEY_ENABLED=false DEV_PYGEOAPI_KEY_GLOBAL=pygeoapi Setting DEV_API_KEY_ENABLE to true is the way to enable a flat protection to the whole pygeoapi sub-application. The value sets in the DEV_PYGEOAPI_KEY_GLOBAL is the secret key that must be used in the Header X-API-KEY to consume the API. Start the server with the usual command: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... File \"<frozen importlib._bootstrap>\", line 1204, in _gcd_import File \"<frozen importlib._bootstrap>\", line 1176, in _find_and_load File \"<frozen importlib._bootstrap>\", line 1147, in _find_and_load_unlocked File \"<frozen importlib._bootstrap>\", line 690, in _load_unlocked File \"<frozen importlib._bootstrap_external>\", line 940, in exec_module File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed File \"/Users/francbartoli/code/fastgeoapi/app/main.py\", line 188, in <module> app = create_app() ^^^^^^^^^^^^ File \"/Users/francbartoli/code/fastgeoapi/app/main.py\", line 138, in create_app raise ValueError( ValueError: OPA_ENABLED, JWKS_ENABLED and API_KEY_ENABLED are mutually exclusive This error is expected since more security schemes at the same time are enabled. Change their value accordingly: DEV_API_KEY_ENABLED=true DEV_OPA_ENABLED=false DEV_JWKS_ENABLED=false and then start again the server: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... 2024-02-26 12:46:25.447 | DEBUG | app.main:<module>:190 [id:None] - Global config: DevConfig(ENV_STATE='dev', HOST='0.0.0.0', PORT='5000', ROOT_PATH='', AWS_LAMBDA_DEPLOY=False, LOG_PATH='/tmp', LOG_FILENAME='fastgeoapi.log', LOG_LEVEL='debug', LOG_ENQUEUE=True, LOG_ROTATION='1 days', LOG_RETENTION='1 months', LOG_FORMAT='<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> [id:{extra[request_id]}] - <level>{message}</level>', OPA_ENABLED=False, OPA_URL='http://localhost:8383', APP_URI='http://localhost:5000', OIDC_WELL_KNOWN_ENDPOINT='http://localhost:8282/realms/pygeoapi/.well-known/openid-configuration', OIDC_CLIENT_ID='pygeoapi-client', OIDC_CLIENT_SECRET='2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD', API_KEY_ENABLED=True, JWKS_ENABLED=False, OAUTH2_JWKS_ENDPOINT='https://uat.interop.pagopa.it/.well-known/jwks.json', OAUTH2_TOKEN_ENDPOINT='https://auth.uat.interop.pagopa.it/token.oauth2', PYGEOAPI_KEY_GLOBAL='pygeoapi', PYGEOAPI_BASEURL='http://localhost:5000', PYGEOAPI_CONFIG='pygeoapi-config.yml', PYGEOAPI_OPENAPI='pygeoapi-openapi.yml', PYGEOAPI_SECURITY_SCHEME='http', FASTGEOAPI_CONTEXT='/geoapi') 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Started server process [171] 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Started server process [171] 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Waiting for application startup. 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Waiting for application startup. 2024-02-26 12:46:25.449 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete. 2024-02-26 12:46:25.449 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete. Let's get testing one of the collection available in the pygeoapi-config.yml (i.e. obs ) without or with the API-KEY: curl http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > < HTTP/1.1 401 Unauthorized < date: Mon, 26 Feb 2024 14:22:28 GMT < server: uvicorn < content-length: 23 < content-type: application/json < * Connection #0 to host localhost left intact {\"detail\":\"no api key\"} Using the API-KEY we are overcoming the unauthorized error and getting the expected response: # This time we are passing the correct security scheme with the secret curl -H \"X-API-KEY: pygeoapi\" http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > X-API-KEY: pygeoapi > < HTTP/1.1 200 OK < date: Mon, 26 Feb 2024 14:25:14 GMT < server: uvicorn < content-length: 3552 < content-type: application/json < x-powered-by: pygeoapi 0.16.dev0 < content-language: en-US < { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://localhost:5000/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://localhost:5000/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" * Connection #0 to host localhost left intact } OAuth2 In this case we are challenging the client to present valid JSON Web Tokens (JWTs) and getting to verify the token\u2019s signature against the public key with the JSON Web Key Set (JWKS) endpoint of the authorization server. Change the .env file with these settings: DEV_API_KEY_ENABLED=false DEV_OPA_ENABLED=false DEV_JWKS_ENABLED=true And configure a valid JWKS and Token endpoint for the authorization server: Use OAuth2 playground There are some playgrounds available which can be used for the sake of testing the workflow. Let's use the one from Auth0 by Okta . # oidc-jwks-only DEV_JWKS_ENABLED=true DEV_OAUTH2_JWKS_ENDPOINT=https://samples.auth0.com/.well-known/jwks.json DEV_OAUTH2_TOKEN_ENDPOINT=https://samples.auth0.com/oauth/token Use the OAuth2 server infrastructure to get the access token and then use that to consume the protected resource from the fastgeoapi server. Let's get testing the collection again: # This time we are passing the OAuth2 security scheme with the retrieved token curl -H \"Authorization: Bearer <access_token>\" http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > X-API-KEY: pygeoapi > < HTTP/1.1 200 OK < date: Mon, 26 Feb 2024 14:25:14 GMT < server: uvicorn < content-length: 3552 < content-type: application/json < x-powered-by: pygeoapi 0.16.dev0 < content-language: en-US < { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://localhost:5000/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://localhost:5000/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" * Connection #0 to host localhost left intact } OpenID Connect OpenID Connect (OIDC) is a protocol built on top of OAuth2 that provides authentication capabilities. It is commonly used for Single-Page Applications (SPA) and mobile applications where user identity verification is required. In fastgeoapi , OIDC authentication is integrated with Open Policy Agent (OPA) for authorization decisions. This means that: Authentication : OIDC verifies the user's identity through an Identity Provider (IdP) Authorization : OPA evaluates policies to determine if the authenticated user can access specific resources Prerequisites Before configuring OIDC, you need to have: An OIDC-compliant Identity Provider (e.g., Keycloak , Logto , Auth0 ) An OPA server running with your authorization policies For local development, you can use the provided Docker Compose setup that includes Keycloak and OPA: cd scripts/iam docker compose up -d This starts: Keycloak on port 8282 with a pre-configured pygeoapi realm OPA on port 8383 with a sample authorization policy Configuration Configure OIDC and OPA in your .env file: # Enable OPA (required for OIDC) DEV_OPA_ENABLED=true DEV_OPA_URL=http://localhost:8383/v1/data/httpapi/authz # OIDC configuration DEV_OIDC_WELL_KNOWN_ENDPOINT=http://localhost:8282/realms/pygeoapi/.well-known/openid-configuration DEV_OIDC_CLIENT_ID=pygeoapi-client DEV_OIDC_CLIENT_SECRET=2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD # Disable other authentication mechanisms DEV_API_KEY_ENABLED=false DEV_JWKS_ENABLED=false Mutual Exclusivity Remember that OPA_ENABLED , API_KEY_ENABLED , and JWKS_ENABLED are mutually exclusive. Only one can be enabled at a time. Start the server: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... 2024-02-26 14:30:00.000 | INFO | app.main:<module>:190 - OPA_ENABLED=True 2024-02-26 14:30:00.001 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete. Testing with curl When OIDC is enabled, requests require a valid access token. First, obtain a token from your Identity Provider: # Get an access token from Keycloak TOKEN = $( curl -s -X POST \\ \"http://localhost:8282/realms/pygeoapi/protocol/openid-connect/token\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=password\" \\ -d \"client_id=pygeoapi-client\" \\ -d \"client_secret=2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD\" \\ -d \"username=testuser\" \\ -d \"password=testpassword\" | jq -r '.access_token' ) Then use the token to access protected endpoints: curl -H \"Authorization: Bearer $TOKEN\" http://localhost:5000/geoapi/collections/obs -vv * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9... > < HTTP/1.1 200 OK < content-type: application/json ... Without a valid token, you will receive a 401 Unauthorized response: curl http://localhost:5000/geoapi/collections/obs -vv * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > < HTTP/1.1 401 Unauthorized < content-type: application/json < {\"message\":\"Unauthorized\"} How it works The authentication and authorization flow works as follows: The client sends a request with an Authorization: Bearer <token> header fastgeoapi validates the token with the OIDC provider using the well-known endpoint User claims (e.g., sub , email , company ) are extracted from the token The request details and user claims are sent to OPA for authorization OPA evaluates the policy and returns an allow: true or allow: false decision If allowed, the request proceeds to pygeoapi; otherwise, a 401 response is returned 401 vs 403 Response Currently, the fastapi-opa library returns 401 Unauthorized for both authentication failures and authorization denials. Ideally, authorization denials should return 403 Forbidden. This is a known limitation tracked in issue #321 Configure a coarse or fine-grained authorization Policies as code TBD","title":"Tutorials"},{"location":"tutorials/#tutorials","text":"","title":"Tutorials"},{"location":"tutorials/#authentication-and-authorization","text":"Familiarize with the topic If you don't have prior experience with the topic, we recommend reading Authentication and Authorization in Applications , which is a really good introduction on the difference between Authentication and Authorization that helps you understand how they focus on two different purposes. This tutorial aims to guide the user to configure fastgeoapi with a mechanism that fits with your security requirements. The tool supports different security schemes for OGC APIs served by pygeoapi and allows optionally to enable a coarse or fine-grade authorization for a collection and the endpoints based on user needs and use cases. Supported security schemes are: API KEY : mostly used for machine to machine communication where a static shared secret can be kept secured or for internal interactions among microservices; OAuth2 : commonly used for authorization to accessing resources between two systems and also for stronger machine to machine communication with external parties when a secret needs to be rotated; OpenID Connect : It looks like very similar to OAuth2 and in fact it is built on top of that. It allows to identify and authenticate a user in mobile and Single-Page Application (SPA). OAuth2 vs OpenID Connect It is beneficial to clarify that they serve two different purposes. OAuth2 is a framework for Authorization while OpenID Connect is a protocol for Authentication . If you would like to develop further the concepts then this is an appropriate read.","title":"Authentication and Authorization"},{"location":"tutorials/#configure-and-protect-pygeoapi","text":"The protection mechanisms introduced above are mutually exclusive and they apply to the whole pygeoapi application that is wrapped by fastgeoapi . The configuration happens in the .env file where the environment variables for development and production are defined. As explained in the getting-started section their prefix identifies the target environment (i.e. DEV_ vs PROD_ ). Let's go through the different mechanisms. Please make sure to have cloned the repo before starting the following sections. Also, it is supposed to having set the environment for development with ENV_STATE=dev in the .env file.","title":"Configure and protect pygeoapi"},{"location":"tutorials/#api-key","text":"The security configuration, in this case, can be enabled with these two additional settings: # api-keys DEV_API_KEY_ENABLED=false DEV_PYGEOAPI_KEY_GLOBAL=pygeoapi Setting DEV_API_KEY_ENABLE to true is the way to enable a flat protection to the whole pygeoapi sub-application. The value sets in the DEV_PYGEOAPI_KEY_GLOBAL is the secret key that must be used in the Header X-API-KEY to consume the API. Start the server with the usual command: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... File \"<frozen importlib._bootstrap>\", line 1204, in _gcd_import File \"<frozen importlib._bootstrap>\", line 1176, in _find_and_load File \"<frozen importlib._bootstrap>\", line 1147, in _find_and_load_unlocked File \"<frozen importlib._bootstrap>\", line 690, in _load_unlocked File \"<frozen importlib._bootstrap_external>\", line 940, in exec_module File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed File \"/Users/francbartoli/code/fastgeoapi/app/main.py\", line 188, in <module> app = create_app() ^^^^^^^^^^^^ File \"/Users/francbartoli/code/fastgeoapi/app/main.py\", line 138, in create_app raise ValueError( ValueError: OPA_ENABLED, JWKS_ENABLED and API_KEY_ENABLED are mutually exclusive This error is expected since more security schemes at the same time are enabled. Change their value accordingly: DEV_API_KEY_ENABLED=true DEV_OPA_ENABLED=false DEV_JWKS_ENABLED=false and then start again the server: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... 2024-02-26 12:46:25.447 | DEBUG | app.main:<module>:190 [id:None] - Global config: DevConfig(ENV_STATE='dev', HOST='0.0.0.0', PORT='5000', ROOT_PATH='', AWS_LAMBDA_DEPLOY=False, LOG_PATH='/tmp', LOG_FILENAME='fastgeoapi.log', LOG_LEVEL='debug', LOG_ENQUEUE=True, LOG_ROTATION='1 days', LOG_RETENTION='1 months', LOG_FORMAT='<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> [id:{extra[request_id]}] - <level>{message}</level>', OPA_ENABLED=False, OPA_URL='http://localhost:8383', APP_URI='http://localhost:5000', OIDC_WELL_KNOWN_ENDPOINT='http://localhost:8282/realms/pygeoapi/.well-known/openid-configuration', OIDC_CLIENT_ID='pygeoapi-client', OIDC_CLIENT_SECRET='2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD', API_KEY_ENABLED=True, JWKS_ENABLED=False, OAUTH2_JWKS_ENDPOINT='https://uat.interop.pagopa.it/.well-known/jwks.json', OAUTH2_TOKEN_ENDPOINT='https://auth.uat.interop.pagopa.it/token.oauth2', PYGEOAPI_KEY_GLOBAL='pygeoapi', PYGEOAPI_BASEURL='http://localhost:5000', PYGEOAPI_CONFIG='pygeoapi-config.yml', PYGEOAPI_OPENAPI='pygeoapi-openapi.yml', PYGEOAPI_SECURITY_SCHEME='http', FASTGEOAPI_CONTEXT='/geoapi') 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Started server process [171] 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Started server process [171] 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Waiting for application startup. 2024-02-26 12:46:25.448 | INFO | logging:callHandlers:1706 [id:app] - Waiting for application startup. 2024-02-26 12:46:25.449 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete. 2024-02-26 12:46:25.449 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete. Let's get testing one of the collection available in the pygeoapi-config.yml (i.e. obs ) without or with the API-KEY: curl http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > < HTTP/1.1 401 Unauthorized < date: Mon, 26 Feb 2024 14:22:28 GMT < server: uvicorn < content-length: 23 < content-type: application/json < * Connection #0 to host localhost left intact {\"detail\":\"no api key\"} Using the API-KEY we are overcoming the unauthorized error and getting the expected response: # This time we are passing the correct security scheme with the secret curl -H \"X-API-KEY: pygeoapi\" http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > X-API-KEY: pygeoapi > < HTTP/1.1 200 OK < date: Mon, 26 Feb 2024 14:25:14 GMT < server: uvicorn < content-length: 3552 < content-type: application/json < x-powered-by: pygeoapi 0.16.dev0 < content-language: en-US < { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://localhost:5000/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://localhost:5000/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" * Connection #0 to host localhost left intact }","title":"API KEY"},{"location":"tutorials/#oauth2","text":"In this case we are challenging the client to present valid JSON Web Tokens (JWTs) and getting to verify the token\u2019s signature against the public key with the JSON Web Key Set (JWKS) endpoint of the authorization server. Change the .env file with these settings: DEV_API_KEY_ENABLED=false DEV_OPA_ENABLED=false DEV_JWKS_ENABLED=true And configure a valid JWKS and Token endpoint for the authorization server: Use OAuth2 playground There are some playgrounds available which can be used for the sake of testing the workflow. Let's use the one from Auth0 by Okta . # oidc-jwks-only DEV_JWKS_ENABLED=true DEV_OAUTH2_JWKS_ENDPOINT=https://samples.auth0.com/.well-known/jwks.json DEV_OAUTH2_TOKEN_ENDPOINT=https://samples.auth0.com/oauth/token Use the OAuth2 server infrastructure to get the access token and then use that to consume the protected resource from the fastgeoapi server. Let's get testing the collection again: # This time we are passing the OAuth2 security scheme with the retrieved token curl -H \"Authorization: Bearer <access_token>\" http://localhost:5000/geoapi/collections/obs -vv * Trying [::1]:5000... * connect to ::1 port 5000 failed: Connection refused * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > User-Agent: curl/8.4.0 > Accept: */* > X-API-KEY: pygeoapi > < HTTP/1.1 200 OK < date: Mon, 26 Feb 2024 14:25:14 GMT < server: uvicorn < content-length: 3552 < content-type: application/json < x-powered-by: pygeoapi 0.16.dev0 < content-language: en-US < { \"id\":\"obs\", \"title\":\"Observations\", \"description\":\"My cool observations\", \"keywords\":[ \"observations\", \"monitoring\" ], \"links\":[ { \"type\":\"text/csv\", \"rel\":\"canonical\", \"title\":\"data\", \"href\":\"https://github.com/mapserver/mapserver/blob/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"text/csv\", \"rel\":\"alternate\", \"title\":\"data\", \"href\":\"https://raw.githubusercontent.com/mapserver/mapserver/branch-7-0/msautotest/wxs/data/obs.csv\", \"hreflang\":\"en-US\" }, { \"type\":\"application/json\", \"rel\":\"root\", \"title\":\"The landing page of this server as JSON\", \"href\":\"http://localhost:5000/geoapi?f=json\" }, { \"type\":\"text/html\", \"rel\":\"root\", \"title\":\"The landing page of this server as HTML\", \"href\":\"http://localhost:5000/geoapi?f=html\" }, { \"type\":\"application/json\", \"rel\":\"self\", \"title\":\"This document as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"alternate\", \"title\":\"This document as RDF (JSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"alternate\", \"title\":\"This document as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs?f=html\" }, { \"type\":\"application/schema+json\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as JSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=json\" }, { \"type\":\"text/html\", \"rel\":\"http://www.opengis.net/def/rel/ogc/1.0/queryables\", \"title\":\"Queryables for this collection as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/queryables?f=html\" }, { \"type\":\"application/geo+json\", \"rel\":\"items\", \"title\":\"items as GeoJSON\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=json\" }, { \"type\":\"application/ld+json\", \"rel\":\"items\", \"title\":\"items as RDF (GeoJSON-LD)\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=jsonld\" }, { \"type\":\"text/html\", \"rel\":\"items\", \"title\":\"Items as HTML\", \"href\":\"http://localhost:5000/geoapi/collections/obs/items?f=html\" } ], \"extent\":{ \"spatial\":{ \"bbox\":[ [ -180, -90, 180, 90 ] ], \"crs\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" }, \"temporal\":{ \"interval\":[ [ \"2000-10-30T18:24:39+00:00\", \"2007-10-30T08:57:29+00:00\" ] ] } }, \"itemType\":\"feature\", \"crs\":[ \"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" ], \"storageCRS\":\"http://www.opengis.net/def/crs/OGC/1.3/CRS84\" * Connection #0 to host localhost left intact }","title":"OAuth2"},{"location":"tutorials/#openid-connect","text":"OpenID Connect (OIDC) is a protocol built on top of OAuth2 that provides authentication capabilities. It is commonly used for Single-Page Applications (SPA) and mobile applications where user identity verification is required. In fastgeoapi , OIDC authentication is integrated with Open Policy Agent (OPA) for authorization decisions. This means that: Authentication : OIDC verifies the user's identity through an Identity Provider (IdP) Authorization : OPA evaluates policies to determine if the authenticated user can access specific resources","title":"OpenID Connect"},{"location":"tutorials/#prerequisites","text":"Before configuring OIDC, you need to have: An OIDC-compliant Identity Provider (e.g., Keycloak , Logto , Auth0 ) An OPA server running with your authorization policies For local development, you can use the provided Docker Compose setup that includes Keycloak and OPA: cd scripts/iam docker compose up -d This starts: Keycloak on port 8282 with a pre-configured pygeoapi realm OPA on port 8383 with a sample authorization policy","title":"Prerequisites"},{"location":"tutorials/#configuration","text":"Configure OIDC and OPA in your .env file: # Enable OPA (required for OIDC) DEV_OPA_ENABLED=true DEV_OPA_URL=http://localhost:8383/v1/data/httpapi/authz # OIDC configuration DEV_OIDC_WELL_KNOWN_ENDPOINT=http://localhost:8282/realms/pygeoapi/.well-known/openid-configuration DEV_OIDC_CLIENT_ID=pygeoapi-client DEV_OIDC_CLIENT_SECRET=2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD # Disable other authentication mechanisms DEV_API_KEY_ENABLED=false DEV_JWKS_ENABLED=false Mutual Exclusivity Remember that OPA_ENABLED , API_KEY_ENABLED , and JWKS_ENABLED are mutually exclusive. Only one can be enabled at a time. Start the server: uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload --loop asyncio ... 2024-02-26 14:30:00.000 | INFO | app.main:<module>:190 - OPA_ENABLED=True 2024-02-26 14:30:00.001 | INFO | logging:callHandlers:1706 [id:app] - Application startup complete.","title":"Configuration"},{"location":"tutorials/#testing-with-curl","text":"When OIDC is enabled, requests require a valid access token. First, obtain a token from your Identity Provider: # Get an access token from Keycloak TOKEN = $( curl -s -X POST \\ \"http://localhost:8282/realms/pygeoapi/protocol/openid-connect/token\" \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"grant_type=password\" \\ -d \"client_id=pygeoapi-client\" \\ -d \"client_secret=2yholx8r3mqyUJaOoJiZhcqvQDQwmgyD\" \\ -d \"username=testuser\" \\ -d \"password=testpassword\" | jq -r '.access_token' ) Then use the token to access protected endpoints: curl -H \"Authorization: Bearer $TOKEN\" http://localhost:5000/geoapi/collections/obs -vv * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9... > < HTTP/1.1 200 OK < content-type: application/json ... Without a valid token, you will receive a 401 Unauthorized response: curl http://localhost:5000/geoapi/collections/obs -vv * Trying 127.0.0.1:5000... * Connected to localhost (127.0.0.1) port 5000 > GET /geoapi/collections/obs HTTP/1.1 > Host: localhost:5000 > < HTTP/1.1 401 Unauthorized < content-type: application/json < {\"message\":\"Unauthorized\"}","title":"Testing with curl"},{"location":"tutorials/#how-it-works","text":"The authentication and authorization flow works as follows: The client sends a request with an Authorization: Bearer <token> header fastgeoapi validates the token with the OIDC provider using the well-known endpoint User claims (e.g., sub , email , company ) are extracted from the token The request details and user claims are sent to OPA for authorization OPA evaluates the policy and returns an allow: true or allow: false decision If allowed, the request proceeds to pygeoapi; otherwise, a 401 response is returned 401 vs 403 Response Currently, the fastapi-opa library returns 401 Unauthorized for both authentication failures and authorization denials. Ideally, authorization denials should return 403 Forbidden. This is a known limitation tracked in issue #321","title":"How it works"},{"location":"tutorials/#configure-a-coarse-or-fine-grained-authorization","text":"","title":"Configure a coarse or fine-grained authorization"},{"location":"tutorials/#policies-as-code","text":"TBD","title":"Policies as code"}]}